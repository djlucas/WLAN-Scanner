[
  {
    "section_title": "I. Application Initialization and Core Setup",
    "modules": [
      {
        "name": "PyQt5 Application Bootstrap",
        "file": "main.py",
        "steps": [
          "Initialize `QApplication` instance.",
          "Load global configuration (see below).",
          "Set up internationalization (`i18n`).",
          "Create the main application window (`MainWindow`).",
          "Show the main window and start the event loop."
        ]
      },
      {
        "name": "Configuration Management",
        "file": "config_manager.py",
        "steps": [
          "Load Configuration: On startup, load application settings from a persistent configuration file (e.g., `~/.WLAN-Scanner/config.json` or `config.ini`).",
          {
            "type": "list",
            "items": [
              "Path to `poppler` binaries (for PDF handling).",
              "Default map image directory.",
              "Language setting (e.g., `en_US`).",
              "Measurement system (Imperial/Metric - boolean).",
              "Any other user preferences."
            ]
          },
          "Initial Setup Check: If configuration file does not exist or essential settings (like poppler path, language) are missing, prompt the user with the \"Preferences\" dialog on first launch. (Scan script paths are now hardcoded and not part of this check).",
          "Save Configuration: Provide functionality to save updated configuration settings."
        ]
      },
      {
        "name": "Internationalization",
        "file": "i18n_manager.py",
        "steps": [
          "Load translation strings from a specified language file (e.g., `i18n/en_US.txt`).",
          "Provide a mechanism to retrieve translated strings for all UI elements and messages.",
          "Allow dynamic language switching via preferences."
        ]
      },
      {
        "name": "Data Models and Structures",
        "file": "data_models.py",
        "steps": [
          {
            "type": "class_struct",
            "name": "APData",
            "description": "Define a structure to hold individual Access Point details from the scan (matches get-wlans script format):",
            "fields": [
              "`ssid` (string)",
              "`bssid` (string)",
              "`channel` (integer)",
              "`signal_strength` (integer, dBm - actual range -20 to -95 dBm)",
              "`security` (string, e.g., \"WPA2\", \"Open\")",
              "`frequency` (integer, MHz)",
              "`quality` (integer, 0-100%)",
              "`band` (string, e.g., \"2.4 GHz\", \"5 GHz\")"
            ]
          },
          {
            "type": "class_struct",
            "name": "ScanPoint", 
            "description": "Represents a user-defined point on the map where a scan was performed (logical measurement points for signal rolloff analysis):",
            "fields": [
              "`map_x`, `map_y` (float/integer coordinates on the scaled map image in metric units internally).",
              "`timestamp` (datetime object).",
              "`ap_list` (list of `APData` objects, representing all APs/BSSIDs seen at this point with measured signal strengths)."
            ]
          },
          {
            "type": "class_struct",
            "name": "PlacedAP",
            "description": "Represents a user-placed Access Point on the map:",
            "fields": [
              "`name` (string, user-defined, mandatory)",
              "`manufacturer` (string, optional)",
              "`model` (string, optional)",
              "`ip_address` (string, optional)",
              "`ethernet_mac` (string, optional)",
              "`serial_number` (string, optional)",
              "`asset_tag` (string, optional)",
              "`map_x`, `map_y` (float/integer coordinates on the scaled map image in metric units internally).",
              "`associated_scan_data` (list of `APData` objects from the immediate scan under this AP).",
              "`primary_bssid` (string, strongest BSSID from associated_scan_data - establishes AP identity).",
              "`timestamp_last_scan` (datetime object for the associated scan)."
            ]
          },
          {
            "type": "class_struct",
            "name": "Floor",
            "description": "Encapsulates data for a single floor plan:",
            "fields": [
              "`floor_number` (integer/string, e.g., \"1\", \"Ground Floor\").",
              "`original_image_path` (string).",
              "`cropped_image_path` (string, path to the internally saved cropped image).",
              "`scaled_image_path` (string, path to the internally saved 1920x1080 scaled image).",
              "`scale_line_horizontal` (ScaleLine object with physical dimensions for metric conversion).",
              "`scale_line_vertical` (ScaleLine object with physical dimensions for metric conversion).",
              "`placed_aps` (list of `PlacedAP` objects).",
              "`scan_points` (list of `ScanPoint` objects).",
              "`bssid_to_ap_mapping` (dict mapping BSSID strings to PlacedAP objects based on empirical scan data).",
              "`empirical_path_loss_data` (dict storing measured signal rolloff between scan points for interpolation)."
            ]
          },
          {
            "type": "class_struct",
            "name": "SiteInfo",
            "description": "Stores general site information:",
            "fields": [
              "`site_name` (string, mandatory).",
              "`street`, `city`, `state_province`, `postal_code`, `country` (strings).",
              "`contact` (string).",
              "`telephone` (string)."
            ]
          },
          {
            "type": "class_struct",
            "name": "MapProject",
            "description": "Encapsulates all data for a complete mapping project:",
            "fields": [
              "`site_info` (`SiteInfo` object).",
              "`floors` (list of `Floor` objects).",
              "`current_floor_index` (integer, index of the currently active floor)."
            ]
          }
        ]
      }
    ]
  },
  {
    "section_title": "II. Interactive Map Interface (IMPLEMENTED)",
    "status": "COMPLETED",
    "modules": [
      {
        "name": "Interactive Map View",
        "file": "interactive_map_view.py",
        "status": "IMPLEMENTED",
        "components": [
          {
            "name": "Right-Click Context Menu System",
            "description": "Professional context-sensitive menus for all map interactions",
            "features": [
              "Right-click empty space: 'Place Access Point Here', 'Run Scan Here (Live/Simulated)', bulk clear operations",
              "Right-click existing AP: Smart menu with Edit Properties, Scan/Rescan, Clear data, Remove options",
              "Context adapts based on AP scan status (scanned vs unscanned)",
              "Comprehensive AP Properties dialog with asset management fields"
            ]
          },
          {
            "name": "Visual AP Status System",
            "description": "Color-coded AP markers indicating scan status",
            "features": [
              "ðŸ”µ Blue APs = Have scan data (surveyed)",
              "ðŸŸ  Orange APs = Need scanning (newly placed or data cleared)",
              "Visual feedback for scan status at a glance"
            ]
          },
          {
            "name": "Drag-and-Drop AP Positioning",
            "description": "Left-click and drag existing APs to reposition them",
            "features": [
              "Smooth dragging with real-time coordinate updates",
              "No accidental placement on left-click empty space"
            ]
          },
          {
            "name": "Immediate Scan Workflow",
            "description": "Smart scanning prompts after AP placement",
            "features": [
              "Automatic prompt: 'AP placed! Run scan now?'",
              "Default Yes for streamlined workflow",
              "Visual status updates (Orange â†’ Blue when scanned)"
            ]
          },
          {
            "name": "Scan Data Management",
            "description": "Flexible scan data lifecycle management",
            "features": [
              "Individual AP scan/rescan/clear options",
              "Bulk operations: 'Clear All AP Scan Data'",
              "Preserve AP layouts while refreshing survey data"
            ]
          }
        ]
      },
      {
        "name": "Dual-Mode Scanning System", 
        "file": "scan_simulator.py",
        "status": "UPDATED - V1/V2 Architecture",
        "description": "Hybrid system supporting both empirical measurement analysis (V1) and theoretical RF prediction (V2)",
        "features": [
          "JSON format matching get-wlans.ps1/sh output exactly",
          "V1 Mode: Empirical measurement-driven analysis using actual scan data",
          "V2 Mode: Theoretical RF modeling for predictive/simulation scenarios",
          "BSSID-to-AP association based on strongest signal at AP scan point",
          "Uses actual placed AP locations from project data",
          "Metric coordinate system for all distance calculations"
        ],
        "implementation_phases": {
          "v1_empirical": "Real measurement data interpolation (current priority)",
          "v2_theoretical": "RF formula-based prediction and 'what-if' modeling (future)"
        }
      }
    ]
  },
  {
    "section_title": "III. User Interface Components",
    "modules": [
      {
        "name": "Main Window",
        "file": "main_window.py",
        "status": "UPDATED",
        "components": [
          {
            "name": "Interactive Map Display",
            "description": "Replaced simple image display with full interactive map view",
            "type": "InteractiveMapView widget"
          },
          {
            "name": "Enhanced Menu System",
            "description": "Updated scan menu with new interactive options",
            "features": [
              "Informational item: 'Place APs and Scan Points (Right-click on map)'",
              "Bulk scan operations in menu bar",
              "Real-time status updates for AP placement and scanning"
            ]
          },
          {
            "name": "Floor Selector",
            "description": "QComboBox for multi-floor navigation (existing)"
          }
        ]
      },
      {
        "name": "Existing Dialogs",
        "status": "WORKING",
        "dialog_list": [
          {
            "name": "Preferences Dialog",
            "file": "preferences_dialog.py",
            "status": "IMPLEMENTED"
          },
          {
            "name": "Site Information Dialog", 
            "file": "site_info_dialog.py",
            "status": "IMPLEMENTED"
          },
          {
            "name": "Floor Import Dialog",
            "file": "floor_import_dialog.py", 
            "status": "IMPLEMENTED"
          },
          {
            "name": "Scale Line Dialog",
            "file": "scale_line_dialog.py",
            "status": "IMPLEMENTED"
          },
          {
            "name": "AP Properties Dialog",
            "file": "interactive_map_view.py (APPropertiesDialog class)",
            "status": "IMPLEMENTED",
            "description": "Comprehensive asset management dialog with manufacturer, model, serial number, ethernet MAC, and asset tag fields"
          }
        ]
      }
    ]
  },
  {
    "section_title": "IV. Core Functionality Status",
    "modules": [
      {
        "name": "Project Management",
        "file": "main_window.py (partial)",
        "status": "PARTIAL - Save/Load needed",
        "functions": [
          {
            "name": "New Project",
            "status": "IMPLEMENTED",
            "description": "Complete workflow from site info to floor import with scale lines"
          },
          {
            "name": "Save/Load Project", 
            "status": "TODO - NEXT PRIORITY",
            "description": "Need JSON serialization/deserialization of MapProject with image handling"
          }
        ]
      },
      {
        "name": "Floor Management",
        "status": "IMPLEMENTED",
        "description": "Complete PDF import, cropping, scaling, scale line definition, and multi-floor navigation with dropdown selector"
      },
      {
        "name": "AP Scanning Process",
        "status": "SIMULATED - Live integration pending",
        "description": "Simulated scanning works perfectly. Need to integrate actual get-wlans scripts.",
        "next_steps": [
          "Add connected network detection to scan scripts",
          "Integrate QProcess execution of actual scripts",
          "Fall back to simulation when scripts unavailable"
        ]
      }
    ]
  },
  {
    "section_title": "V. Next Development Phase - TOMORROW'S TASKS",
    "priorities": [
      {
        "priority": 1,
        "task": "Save/Load Functionality",
        "description": "Project persistence to enable data visualization development",
        "components": [
          "JSON serialization of MapProject objects", 
          "Image file management (copy to project directory)",
          "ZIP-based .wls project file format",
          "File dialogs for save/open operations"
        ]
      },
      {
        "priority": 2,
        "task": "V1 Empirical Data Visualization", 
        "description": "Measurement-driven heatmap generation and analysis (Phase 1 implementation)",
        "components": [
          "BSSID-to-AP association algorithm (strongest signal at AP location)",
          "Empirical path loss modeling from actual scan point measurements",
          "Signal strength interpolation using real measurement data (V1 focus)",
          "Metric-based distance calculations for accurate coverage modeling",
          "Circular heatmap rendering reflecting realistic RF propagation patterns",
          "Connected network focus with BSSID-specific signal rolloff visualization"
        ],
        "future_v2_components": [
          "Theoretical RF prediction engine for AP placement optimization",
          "Simulated coverage modeling for 'what-if' scenarios",
          "Predictive heatmaps for unmeasured floor areas",
          "Coverage gap prediction and recommendation algorithms"
        ]
      },
      {
        "priority": 3,
        "task": "Live WiFi Integration", 
        "description": "Connect to actual get-wlans scripts",
        "components": [
          "QProcess execution of platform-specific scripts",
          "Connected network detection enhancement",
          "Error handling for script failures",
          "Fallback to simulation mode"
        ]
      },
      {
        "priority": 4,
        "task": "Professional Report Generation System",
        "description": "Multi-format PDF reporting with comprehensive visualization integration",
        "components": [
          "Executive Report Format: High-level coverage summaries with key metrics and professional recommendations",
          "Technical Report Format: Detailed signal analysis with AP specifications and measurement tables",
          "Interference Map Engine: Channel utilization analysis with peak signal aggregation across all detected networks",
          "Multi-Map PDF Integration: Embedded floor plans, signal heatmaps, and interference visualizations",
          "Template System: Jinja2-based HTML templates with professional print CSS styling",
          "Data Export: AP tables, signal strength measurements, and coverage statistics"
        ],
        "estimated_effort": "Major development phase - represents ~25% of remaining application functionality"
      }
    ],
    "empirical_observations": {
      "signal_propagation": {
        "date_collected": "2025-09-12",
        "environment": "Indoor office, 20-22ft measurements with LOS and single closed door",
        "vendor": "TP-Link (OUI: 9C-A2-F4)",
        "path_loss_model": {
          "2_4_ghz_los": "~0.5 dB per foot (20ft: 9-10 dB loss)",
          "5_ghz_los": "~0.6 dB per foot (20ft: 11-13 dB loss)", 
          "door_penalty": "~3-4 dB additional attenuation (22ft + door: 14 dB total)",
          "baseline_power": "-22 dBm (2.4GHz), -28 dBm (5GHz) at AP location"
        }
      },
      "bssid_allocation_patterns": {
        "date_observed": "2025-09-12",
        "tp_link": {
          "oui_pattern": "9C-A2-F4",
          "hardware_base_mac": "9C:A2:F4:4C:AA:8E",
          "ssid_differentiation": "First octet varies by virtual SSID (9C=WLANS, A6={Hidden}, A2=WLANS-IOT, AA=WLANS-Guest)",
          "band_differentiation": "Last octet increments for different radio (8E=2.4GHz, 8F=5GHz)",
          "pattern": "Virtual BSSIDs derived from base MAC with first/last octet modifications",
          "notes": "Pattern observed on single vendor - need additional vendor data for validation"
        },
        "pending_data": "Additional vendor BSSID patterns expected Monday for comparison analysis"
      }
    },
    "future_v2_roadmap": [
      {
        "priority": "Future V2.1",
        "task": "Predictive RF Modeling Engine",
        "description": "Theoretical RF calculations for simulation and prediction",
        "components": [
          "Restore and enhance theoretical RF propagation formulas",
          "AP placement optimization algorithms", 
          "Coverage prediction for unmeasured areas",
          "'What-if' scenario modeling with different AP configurations",
          "Empirical data calibration of theoretical models"
        ]
      },
      {
        "priority": "Future V2.2", 
        "task": "Advanced Site Planning",
        "description": "AI-assisted AP placement and coverage optimization",
        "components": [
          "Automatic AP placement recommendations",
          "Coverage gap detection and resolution",
          "Multi-floor interference modeling",
          "Capacity planning based on user density",
          "ROI analysis for different deployment scenarios"
        ]
      }
    ]
  },
  {
    "section_title": "VI. Technical Decisions Made",
    "decisions": [
      {
        "topic": "Heatmap Color Gradient",
        "decision": "Green (-20 to -45 dBm) â†’ Yellow (-45 to -60) â†’ Orange (-60 to -75) â†’ Red (-75 to -90) â†’ Blue (-90+ dBm)",
        "rationale": "Based on actual scan data showing signals as strong as -23 dBm, not the typical -30 dBm Windows limitation"
      },
      {
        "topic": "Heatmap Focus",
        "decision": "Primary heatmap shows connected network signal strength",
        "rationale": "Most site surveys focus on coverage of the surveyed network, with secondary option to view other networks"
      },
      {
        "topic": "Report Generation Pipeline",
        "decision": "Qt â†’ HTML â†’ PDF via Poppler (not browser-based)",
        "rationale": "Leverages existing Qt/Poppler ecosystem, allows precise control over technical documentation layout"
      },
      {
        "topic": "Interaction Model",
        "decision": "Right-click only for placement, left-click for dragging",
        "rationale": "Eliminates accidental AP placement, more professional and deliberate workflow"
      },
      {
        "topic": "Scan Data Management",
        "decision": "Separate scan data lifecycle from AP placement",
        "rationale": "Allows site refresh surveys without losing carefully positioned AP layouts"
      },
      {
        "topic": "Signal Modeling Approach",
        "decision": "V1: Empirical measurement-driven analysis, V2: Theoretical RF prediction",
        "rationale": "V1 focuses on accurate analysis of real scan data using empirical interpolation. V2 will add theoretical RF formulas for predictive modeling and AP placement optimization. Real measurements validate and calibrate theoretical models."
      },
      {
        "topic": "Coordinate System", 
        "decision": "Metric units for all internal distance calculations regardless of display locale",
        "rationale": "dBm measurements require consistent metric-based distance calculations for accurate path loss modeling and coverage analysis"
      }
    ]
  },
  {
    "section_title": "VII. Current Application State",
    "status": "Data Visualization Phase (~75% Complete)",
    "capabilities": [
      "âœ… Complete project creation workflow",
      "âœ… PDF floor plan import with cropping and scaling",
      "âœ… Interactive AP placement with right-click context menus",
      "âœ… Visual status indicators (blue/orange APs)",
      "âœ… Drag-and-drop AP repositioning",
      "âœ… Live WiFi scanning with platform-specific scripts",
      "âœ… Advanced heatmap visualization with empirical signal analysis",
      "âœ… Project save/load functionality with ZIP-based .wls format",
      "âœ… Multi-floor navigation with automatic dropdown selector",
      "âœ… Flexible scan data management",
      "âœ… Smart workflow with immediate scan prompts",
      "âœ… Performance-optimized zoom operations without heatmap recalculation",
      "âœ… Robust painting operations with exception safety",
      "âœ… Enhanced user experience with custom status bar and visual legends",
      "âœ… Comprehensive progress indicators with internationalization support",
      "âœ… Optimized heatmap generation (~5s) with elimination of double-generation issues",
      "âœ… Advanced scroll bar navigation with fit-to-window defaults",
      "âœ… SSID-based heatmap network selection and identification",
      "âœ… Comprehensive AP asset management with properties dialog (manufacturer, model, serial number, ethernet MAC, asset tag)",
      "âœ… Project persistence compatibility for AP properties with backward/forward compatibility"
    ]
  }
]